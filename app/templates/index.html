{% extends "base.html" %}
{% block title %}Accueil — Plateforme interne{% endblock %}

{% block content %}
{% if current_user %}
<!-- Menu pour utilisateurs connectés -->
<div class="max-w-5xl mx-auto">
  <div class="mb-10 text-center">
    <h1 class="text-4xl font-bold text-gray-900 mb-3">
      Bienvenue, {{ current_user.first_name }} !
    </h1>
    <p class="text-gray-600 mb-4">
      Plateforme de gestion PAP/CSE
    </p>
    <div class="max-w-3xl mx-auto bg-gradient-to-r from-cgt-red/10 to-purple-100 rounded-xl p-6 border border-cgt-red/20">
      <p class="text-gray-700 leading-relaxed">
        Cette plateforme vous permet de piloter vos invitations PAP Cycle 5, suivre les prochaines échéances électorales et analyser la couverture syndicale CGT sur l'ensemble du territoire. Accédez aux statistiques, générez des rapports intelligents et utilisez notre assistant IA pour répondre à vos questions.
      </p>
    </div>
  </div>

  <!-- Menu principal -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

    <a href="/stats" class="bg-white rounded-xl shadow-md hover:shadow-xl transition p-6 border-2 border-transparent hover:border-cgt-red">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-chart-line text-2xl text-purple-600"></i>
        </div>
        <i class="fas fa-arrow-right text-gray-400"></i>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Statistiques</h3>
      <p class="text-sm text-gray-600">Tableaux de bord et analyses</p>
    </a>

    <a href="/invitations" class="bg-white rounded-xl shadow-md hover:shadow-xl transition p-6 border-2 border-transparent hover:border-cgt-red">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-envelope-open-text text-2xl text-blue-600"></i>
        </div>
        <i class="fas fa-arrow-right text-gray-400"></i>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Invitations PAP</h3>
      <p class="text-sm text-gray-600">Liste complète des invitations</p>
    </a>

    <a href="/calendrier" class="bg-white rounded-xl shadow-md hover:shadow-xl transition p-6 border-2 border-transparent hover:border-cgt-red">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-calendar-alt text-2xl text-green-600"></i>
        </div>
        <i class="fas fa-arrow-right text-gray-400"></i>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Calendrier +1000</h3>
      <p class="text-sm text-gray-600">Prochaines élections</p>
    </a>

    <a href="/cartographie" class="bg-white rounded-xl shadow-md hover:shadow-xl transition p-6 border-2 border-transparent hover:border-cgt-red">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-map text-2xl text-indigo-600"></i>
        </div>
        <i class="fas fa-arrow-right text-gray-400"></i>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Cartographie</h3>
      <p class="text-sm text-gray-600">Carte de France interactive</p>
    </a>

    <a href="/ciblage" class="bg-white rounded-xl shadow-md hover:shadow-xl transition p-6 border-2 border-transparent hover:border-cgt-red">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-crosshairs text-2xl text-orange-600"></i>
        </div>
        <i class="fas fa-arrow-right text-gray-400"></i>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Ciblage</h3>
      <p class="text-sm text-gray-600">Analyse de la cible prioritaire</p>
    </a>

    <a href="/recherche-siret" class="bg-white rounded-xl shadow-md hover:shadow-xl transition p-6 border-2 border-transparent hover:border-cgt-red">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-teal-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-plus-circle text-2xl text-teal-600"></i>
        </div>
        <i class="fas fa-arrow-right text-gray-400"></i>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Ajout PAP</h3>
      <p class="text-sm text-gray-600">Ajouter une invitation</p>
    </a>

    {% if current_user.role == "admin" %}
    <a href="/admin" class="bg-gradient-to-br from-cgt-red to-cgt-darkred text-white rounded-xl shadow-md hover:shadow-xl transition p-6 border-2 border-cgt-red">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
          <i class="fas fa-cog text-2xl text-white"></i>
        </div>
        <i class="fas fa-arrow-right text-white/70"></i>
      </div>
      <h3 class="text-lg font-bold mb-2">Administration</h3>
      <p class="text-sm text-white/80">Gestion de la plateforme</p>
    </a>
    {% endif %}

    <a href="/presentation" class="bg-white rounded-xl shadow-md hover:shadow-xl transition p-6 border-2 border-transparent hover:border-cgt-red">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-pink-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-bullseye text-2xl text-pink-600"></i>
        </div>
        <i class="fas fa-arrow-right text-gray-400"></i>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Présentation</h3>
      <p class="text-sm text-gray-600">Présentation cible PAP</p>
    </a>

    <a href="/extraction" class="bg-white rounded-xl shadow-md hover:shadow-xl transition p-6 border-2 border-transparent hover:border-cgt-red">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-yellow-100 rounded-lg flex items-center justify-center">
          <i class="fas fa-scan text-2xl text-yellow-600"></i>
        </div>
        <i class="fas fa-arrow-right text-gray-400"></i>
      </div>
      <h3 class="text-lg font-bold text-gray-900 mb-2">Scanner PAP</h3>
      <p class="text-sm text-gray-600">Extraction de données</p>
    </a>

    <!-- Carte Chatbot Assistant IA -->
    <button onclick="ouvrirChatbot()" class="bg-gradient-to-br from-indigo-500 to-purple-600 text-white rounded-xl shadow-md hover:shadow-2xl transition p-6 border-2 border-indigo-600 text-left group">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
          <i class="fas fa-comments text-2xl text-white"></i>
        </div>
        <i class="fas fa-arrow-right text-white/70 group-hover:text-white"></i>
      </div>
      <h3 class="text-lg font-bold mb-2 flex items-center gap-2">
        <span class="px-2 py-0.5 bg-yellow-400 text-yellow-900 rounded text-xs font-bold">IA</span>
        Assistant Expert
      </h3>
      <p class="text-sm text-white/90">Posez vos questions à l'IA</p>
    </button>

    <!-- Carte Super Rapport Intelligent -->
    <button onclick="genererSuperRapport()" class="bg-gradient-to-br from-pink-500 to-purple-600 text-white rounded-xl shadow-md hover:shadow-2xl transition p-6 border-2 border-pink-600 text-left group">
      <div class="flex items-center justify-between mb-4">
        <div class="w-12 h-12 bg-white/20 rounded-lg flex items-center justify-center">
          <i class="fas fa-chart-line text-2xl text-white"></i>
        </div>
        <i class="fas fa-arrow-right text-white/70 group-hover:text-white"></i>
      </div>
      <h3 class="text-lg font-bold mb-2 flex items-center gap-2">
        <span class="px-2 py-0.5 bg-yellow-400 text-yellow-900 rounded text-xs font-bold">⚡</span>
        Super Rapport IA
      </h3>
      <p class="text-sm text-white/90">Analyse avancée des cibles PAP</p>
    </button>
  </div>
</div>

<!-- Modals pour Chatbot et Rapport - Charger depuis admin.html -->
<script>
// Redirection vers la page admin avec les modals
function ouvrirChatbot() {
  window.location.href = '/admin#chatbot';
  // Si on est déjà sur admin, ouvrir directement la modal
  if (window.location.pathname === '/admin') {
    if (typeof ouvrirAssistantExpert === 'function') {
      ouvrirAssistantExpert();
    }
  }
}

function genererSuperRapport() {
  window.location.href = '/admin#rapport';
  // Si on est déjà sur admin, ouvrir directement la modal
  if (window.location.pathname === '/admin') {
    if (typeof genererRapportIA === 'function') {
      genererRapportIA();
    }
  }
}
</script>

{% else %}
<!-- Page publique pour visiteurs non connectés -->
<div class="flex items-center justify-center min-h-[70vh]">
  <div class="text-center">
    <div class="mb-8">
      <i class="fas fa-lock text-6xl text-cgt-red mb-4"></i>
    </div>
    <h1 class="text-5xl font-bold text-gray-900 mb-4">
      Plateforme interne
    </h1>
    <p class="text-xl text-gray-600 mb-8">
      Accès réservé aux utilisateurs autorisés
    </p>
    <div class="flex justify-center gap-4">
      <a href="/login" class="inline-flex items-center gap-2 px-8 py-4 bg-cgt-red hover:bg-cgt-darkred text-white font-semibold rounded-lg shadow-lg transition">
        <i class="fas fa-sign-in-alt"></i>
        Se connecter
      </a>
      <a href="/signup" class="inline-flex items-center gap-2 px-8 py-4 bg-gray-700 hover:bg-gray-800 text-white font-semibold rounded-lg shadow-lg transition">
        <i class="fas fa-user-plus"></i>
        S'inscrire
      </a>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}
