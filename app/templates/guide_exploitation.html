{% extends "base.html" %}
{% block title %}Guide d'exploitation IA · PAP/CSE{% endblock %}

{% block content %}
<main class="py-10 px-4 sm:px-6 lg:px-8">
  <div class="max-w-6xl mx-auto space-y-10">
    <section class="bg-white rounded-3xl shadow-xl ring-1 ring-gray-100 p-8 lg:p-12 relative overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-r from-red-50 via-white to-rose-50 opacity-70 pointer-events-none"></div>
      <div class="relative flex flex-col gap-8 lg:flex-row lg:items-center">
        <div class="lg:w-3/5 space-y-6">
          <p class="text-sm font-semibold uppercase tracking-widest text-cgt-red">Guide stratégique</p>
          <h1 class="text-3xl sm:text-4xl font-bold text-gray-900">
            Mettre l'IA au service des invitations PAP/CSE
          </h1>
          <p class="text-lg text-gray-600 leading-relaxed">
            Cette page synthétise le guide partagé dans la dernière release (format PDF) afin de le rendre immédiatement actionnable dans l'outil : vision des usages actuels, idées de déploiement rapide, scénarios d'automatisation et estimation des coûts pour prioriser les prochains chantiers.
          </p>
          <div class="flex flex-wrap gap-3 text-sm text-gray-600">
            <span class="px-3 py-1 rounded-full bg-white shadow-sm border border-red-100">Extraction de documents</span>
            <span class="px-3 py-1 rounded-full bg-white shadow-sm border border-red-100">Chatbot & analyse</span>
            <span class="px-3 py-1 rounded-full bg-white shadow-sm border border-red-100">Alertes & workflows</span>
            <span class="px-3 py-1 rounded-full bg-white shadow-sm border border-red-100">Rapports intelligents</span>
          </div>
        </div>
        <div class="lg:w-2/5 bg-white/90 backdrop-blur rounded-2xl p-6 shadow-lg border border-white">
          <p class="text-sm font-semibold text-gray-500 uppercase tracking-widest">En résumé</p>
          <dl class="mt-4 space-y-4 text-gray-800">
            <div class="flex items-center justify-between">
              <dt class="text-base font-medium">Cas d'usage couverts</dt>
              <dd class="text-2xl font-semibold text-cgt-red">10+</dd>
            </div>
            <div class="flex items-center justify-between">
              <dt class="text-base font-medium">Priorités court terme</dt>
              <dd class="text-2xl font-semibold text-cgt-red">3</dd>
            </div>
            <div class="flex items-center justify-between">
              <dt class="text-base font-medium">Économie potentielle</dt>
              <dd class="text-2xl font-semibold text-cgt-red">97%</dd>
            </div>
          </dl>
          <p class="mt-6 text-sm text-gray-600">
            Source : guide PDF « Exploitation IA » (release outils PAP/CSE, novembre 2024).
          </p>
        </div>
      </div>
    </section>

    <section class="grid lg:grid-cols-3 gap-6">
      <article class="bg-white rounded-2xl shadow p-6 border border-gray-100">
        <p class="text-sm font-semibold text-gray-500 uppercase tracking-widest">Objectif</p>
        <h2 class="mt-3 text-2xl font-bold text-gray-900">Industrialiser les extractions</h2>
        <ul class="mt-4 space-y-2 text-gray-600">
          <li class="flex gap-3"><span class="text-cgt-red font-semibold">•</span>Documents PDF, images et scans convertis automatiquement.</li>
          <li class="flex gap-3"><span class="text-cgt-red font-semibold">•</span>Enrichissement IDCC & validation SIRET en boucle fermée.</li>
          <li class="flex gap-3"><span class="text-cgt-red font-semibold">•</span>Traçabilité des coûts par modèle (gpt-4o vs 4o-mini).</li>
        </ul>
      </article>
      <article class="bg-white rounded-2xl shadow p-6 border border-gray-100">
        <p class="text-sm font-semibold text-gray-500 uppercase tracking-widest">Livrables</p>
        <h2 class="mt-3 text-2xl font-bold text-gray-900">Alertes & rapports</h2>
        <ul class="mt-4 space-y-2 text-gray-600">
          <li class="flex gap-3"><span class="text-cgt-red font-semibold">•</span>Alertes retard (J-30, J-15, J-7) directement dans le calendrier.</li>
          <li class="flex gap-3"><span class="text-cgt-red font-semibold">•</span>Rapports hebdo UD/FD générés automatiquement.</li>
          <li class="flex gap-3"><span class="text-cgt-red font-semibold">•</span>Checklist conformité PAP et PV.</li>
        </ul>
      </article>
      <article class="bg-white rounded-2xl shadow p-6 border border-gray-100">
        <p class="text-sm font-semibold text-gray-500 uppercase tracking-widest">Public cible</p>
        <h2 class="mt-3 text-2xl font-bold text-gray-900">UD, FD & admins</h2>
        <ul class="mt-4 space-y-2 text-gray-600">
          <li class="flex gap-3"><span class="text-cgt-red font-semibold">•</span>Responsables UD pour la visibilité départementale.</li>
          <li class="flex gap-3"><span class="text-cgt-red font-semibold">•</span>Cellule nationale pour prioriser les workflows.</li>
          <li class="flex gap-3"><span class="text-cgt-red font-semibold">•</span>Admins techniques pour piloter les coûts IA.</li>
        </ul>
      </article>
    </section>

    <section x-data="{ tab: 'panorama' }" class="bg-white rounded-3xl shadow-xl ring-1 ring-gray-100 p-6 sm:p-10">
      <div class="flex flex-wrap gap-3">
        <button type="button" class="px-4 py-2 rounded-full text-sm font-semibold"
                :class="tab === 'panorama' ? 'bg-cgt-red text-white shadow-lg' : 'bg-gray-100 text-gray-600'"
                @click="tab = 'panorama'">Panorama actuel</button>
        <button type="button" class="px-4 py-2 rounded-full text-sm font-semibold"
                :class="tab === 'exploitation' ? 'bg-cgt-red text-white shadow-lg' : 'bg-gray-100 text-gray-600'"
                @click="tab = 'exploitation'">Déploiement express</button>
        <button type="button" class="px-4 py-2 rounded-full text-sm font-semibold"
                :class="tab === 'automation' ? 'bg-cgt-red text-white shadow-lg' : 'bg-gray-100 text-gray-600'"
                @click="tab = 'automation'">Automatisation</button>
        <button type="button" class="px-4 py-2 rounded-full text-sm font-semibold"
                :class="tab === 'invest' ? 'bg-cgt-red text-white shadow-lg' : 'bg-gray-100 text-gray-600'"
                @click="tab = 'invest'">Investissements</button>
        <button type="button" class="px-4 py-2 rounded-full text-sm font-semibold"
                :class="tab === 'ressources' ? 'bg-cgt-red text-white shadow-lg' : 'bg-gray-100 text-gray-600'"
                @click="tab = 'ressources'">Ressources & actions</button>
      </div>

      <div class="mt-10 space-y-8">
        <div x-show="tab === 'panorama'" x-cloak class="grid lg:grid-cols-2 gap-8">
          <article class="p-6 bg-rose-50 rounded-2xl border border-rose-100">
            <h3 class="text-xl font-semibold text-gray-900">Utilisation actuelle</h3>
            <p class="mt-3 text-gray-600">Extraction automatisée des invitations PAP (PDF, images) avec :</p>
            <ul class="mt-4 space-y-2 text-gray-700">
              <li class="flex gap-3"><span class="text-cgt-red">✓</span>SIRET/SIREN, IDCC, effectifs, dates clés, syndicats invités.</li>
              <li class="flex gap-3"><span class="text-cgt-red">✓</span>Gestion multi-modèles (gpt-4o, gpt-4o-mini) et fallback.</li>
              <li class="flex gap-3"><span class="text-cgt-red">✓</span>Traçabilité via le service <code class="px-2 py-0.5 bg-white rounded">document_extractor.py</code>.</li>
            </ul>
          </article>
          <article class="p-6 bg-indigo-50 rounded-2xl border border-indigo-100">
            <h3 class="text-xl font-semibold text-gray-900">Opportunités immédiates</h3>
            <ul class="mt-4 space-y-3 text-gray-700">
              <li><strong>Enrichissement IDCC</strong> : rescanner les dossiers incomplets.</li>
              <li><strong>Validation d'intégrité</strong> : comparer RAISONS sociales vs API SIRENE.</li>
              <li><strong>Classification</strong> : détecter les protocoles d'accord, PV, urgences.</li>
              <li><strong>Chatbot</strong> : requêtes naturelles (« Combien d'invitations en retard ?»).</li>
            </ul>
          </article>
        </div>

        <div x-show="tab === 'exploitation'" x-cloak class="space-y-6">
          <div class="grid md:grid-cols-3 gap-6">
            <article class="p-5 rounded-2xl border border-gray-100 bg-gradient-to-br from-white to-emerald-50">
              <p class="text-sm font-semibold text-emerald-700">Étape 1</p>
              <h3 class="mt-2 text-lg font-bold text-gray-900">Corriger les invitations</h3>
              <p class="mt-2 text-gray-600">Scanner toutes les invitations sans IDCC et compléter automatiquement.</p>
            </article>
            <article class="p-5 rounded-2xl border border-gray-100 bg-gradient-to-br from-white to-amber-50">
              <p class="text-sm font-semibold text-amber-700">Étape 2</p>
              <h3 class="mt-2 text-lg font-bold text-gray-900">Alertes calendrier</h3>
              <p class="mt-2 text-gray-600">Déclencher des notifications J-30 / J-15 / J-7 dans le calendrier existant.</p>
            </article>
            <article class="p-5 rounded-2xl border border-gray-100 bg-gradient-to-br from-white to-sky-50">
              <p class="text-sm font-semibold text-sky-700">Étape 3</p>
              <h3 class="mt-2 text-lg font-bold text-gray-900">Rapports UD/FD</h3>
              <p class="mt-2 text-gray-600">Générer automatiquement un résumé exécutif hebdomadaire.</p>
            </article>
          </div>
          <div class="bg-gray-50 border border-gray-100 rounded-2xl p-6">
            <h4 class="text-lg font-semibold text-gray-900">Checklist « Déploiement express »</h4>
            <ol class="mt-4 space-y-3 text-gray-700 list-decimal list-inside">
              <li>Créer le service <code class="px-2 py-0.5 bg-white rounded">ia_enrichment.py</code>.</li>
              <li>Planifier les relances sur invitations en retard.</li>
              <li>Ajouter des tuiles d'alertes dédiées dans l'accueil.</li>
            </ol>
          </div>
        </div>

        <div x-show="tab === 'automation'" x-cloak class="grid lg:grid-cols-2 gap-8">
          <article class="p-6 rounded-2xl border border-gray-100 bg-white">
            <h3 class="text-xl font-semibold text-gray-900">Workflow complet</h3>
            <ul class="mt-4 space-y-3 text-gray-700">
              <li class="flex gap-3"><span class="text-cgt-red">1</span>Email entrant détecté → classification auto.</li>
              <li class="flex gap-3"><span class="text-cgt-red">2</span>Extraction IA et création dossier élection.</li>
              <li class="flex gap-3"><span class="text-cgt-red">3</span>Calcul sièges + alertes multi-échéances.</li>
              <li class="flex gap-3"><span class="text-cgt-red">4</span>Import PV + extraction résultats détaillés.</li>
              <li class="flex gap-3"><span class="text-cgt-red">5</span>Rapport final envoyé aux UD/FD.</li>
            </ul>
          </article>
          <article class="p-6 rounded-2xl border border-gray-100 bg-slate-50">
            <h3 class="text-xl font-semibold text-gray-900">Niveau avancé</h3>
            <p class="mt-2 text-gray-600">Pour les documents complexes :</p>
            <ul class="mt-4 space-y-2 text-gray-700">
              <li>OCR + IA pour scans manuscrits.</li>
              <li>Apprentissage continu sur les formats CGT.</li>
              <li>Détection multi-langues & reconnaissance de signatures.</li>
              <li>Comparaison IA + API SIRENE pour détecter les anomalies.</li>
            </ul>
          </article>
        </div>

        <div x-show="tab === 'invest'" x-cloak class="grid md:grid-cols-2 gap-8">
          <article class="p-6 rounded-2xl border border-gray-100 bg-gradient-to-br from-white to-rose-50">
            <h3 class="text-xl font-semibold text-gray-900">Budget indicatif</h3>
            <table class="mt-4 w-full text-sm text-gray-700">
              <thead>
                <tr class="text-left text-gray-500 uppercase text-xs">
                  <th class="py-2">Volume</th>
                  <th class="py-2">Modèle</th>
                  <th class="py-2 text-right">Coût</th>
                </tr>
              </thead>
              <tbody>
                <tr class="border-t border-gray-100">
                  <td class="py-2">100 docs</td>
                  <td class="py-2">gpt-4o-mini</td>
                  <td class="py-2 text-right">~1,50 €</td>
                </tr>
                <tr class="border-t border-gray-100">
                  <td class="py-2">100 docs</td>
                  <td class="py-2">gpt-4o</td>
                  <td class="py-2 text-right">~50 €</td>
                </tr>
                <tr class="border-t border-gray-100">
                  <td class="py-2">1000 docs</td>
                  <td class="py-2">gpt-4o-mini</td>
                  <td class="py-2 text-right">~15 €</td>
                </tr>
                <tr class="border-t border-gray-100">
                  <td class="py-2">1000 docs</td>
                  <td class="py-2">gpt-4o</td>
                  <td class="py-2 text-right">~500 €</td>
                </tr>
              </tbody>
            </table>
            <p class="mt-4 text-sm text-gray-600">→ Utiliser gpt-4o-mini pour 97 % d'économie, réserver gpt-4o aux cas critiques.</p>
          </article>
          <article class="p-6 rounded-2xl border border-gray-100 bg-white">
            <h3 class="text-xl font-semibold text-gray-900">Optimisations</h3>
            <ul class="mt-4 space-y-2 text-gray-700">
              <li>Redimensionner les images (≤ 2000px) et compresser en PNG.</li>
              <li>Activer le cache des résultats pour éviter les doublons.</li>
              <li>Planifier les workflows intensifs hors heures de pointe.</li>
              <li>Mesurer le coût moyen par dossier dans l'admin.</li>
            </ul>
          </article>
        </div>

        <div x-show="tab === 'ressources'" x-cloak class="grid lg:grid-cols-2 gap-8">
          <article class="p-6 rounded-2xl border border-gray-100 bg-white">
            <h3 class="text-xl font-semibold text-gray-900">Priorités & roadmap</h3>
            <ul class="mt-4 space-y-3 text-gray-700">
              <li><strong>Priorité 1</strong> : Enrichissement IDCC, alertes dates limites.</li>
              <li><strong>Priorité 2</strong> : Extraction PV, validation conformité, rapports hebdo.</li>
              <li><strong>Priorité 3</strong> : Chatbot avancé, analyse prédictive, workflow complet.</li>
            </ul>
            <p class="mt-4 text-sm text-gray-600">Chaque jalon peut être suivi via une carte dédiée dans l'accueil.</p>
          </article>
          <article class="p-6 rounded-2xl border border-gray-100 bg-slate-50">
            <h3 class="text-xl font-semibold text-gray-900">Ressources techniques</h3>
            <ul class="mt-4 space-y-2 text-gray-700">
              <li><code class="px-2 py-0.5 bg-white rounded">app/services/document_extractor.py</code></li>
              <li><code class="px-2 py-0.5 bg-white rounded">app/templates/extraction.html</code></li>
              <li>Endpoints recommandés : <code class="px-2 py-0.5 bg-white rounded">POST /api/extract/pv-election</code>, <code class="px-2 py-0.5 bg-white rounded">POST /api/ia/generer-rapport</code>.</li>
              <li>Variables d'env : <code class="px-2 py-0.5 bg-white rounded">OPENAI_API_KEY</code>, <code class="px-2 py-0.5 bg-white rounded">OPENAI_MODEL</code>.</li>
            </ul>
          </article>
        </div>
      </div>
    </section>

    <section class="grid lg:grid-cols-3 gap-6">
      <article class="bg-white rounded-2xl p-6 shadow border border-gray-100">
        <p class="text-sm font-semibold text-gray-500 uppercase tracking-widest">Bonnes pratiques</p>
        <h3 class="mt-3 text-2xl font-bold text-gray-900">Qualité des sources</h3>
        <ul class="mt-4 space-y-2 text-gray-700">
          <li>Privilégier les scans ≥ 150 DPI.</li>
          <li>Redresser les documents avant upload.</li>
          <li>Contrôler SIRET, dates et effectifs extraits.</li>
        </ul>
      </article>
      <article class="bg-white rounded-2xl p-6 shadow border border-gray-100">
        <p class="text-sm font-semibold text-gray-500 uppercase tracking-widest">Feedback</p>
        <h3 class="mt-3 text-2xl font-bold text-gray-900">Boucle d'amélioration</h3>
        <ul class="mt-4 space-y-2 text-gray-700">
          <li>Taguer les extractions incorrectes.</li>
          <li>Conserver les cas difficiles pour entraînement.</li>
          <li>Partager les prompts efficaces.</li>
        </ul>
      </article>
      <article class="bg-white rounded-2xl p-6 shadow border border-gray-100">
        <p class="text-sm font-semibold text-gray-500 uppercase tracking-widest">Raccourcis</p>
        <h3 class="mt-3 text-2xl font-bold text-gray-900">Passer à l'action</h3>
        <div class="mt-4 space-y-3 text-sm">
          <a href="/extraction" class="flex items-center justify-between px-4 py-3 rounded-2xl bg-red-50 text-cgt-red font-semibold hover:bg-red-100">
            Lancer une extraction
            <i class="fas fa-arrow-right"></i>
          </a>
          <a href="/calendrier" class="flex items-center justify-between px-4 py-3 rounded-2xl bg-amber-50 text-amber-800 font-semibold hover:bg-amber-100">
            Vérifier les échéances
            <i class="fas fa-calendar"></i>
          </a>
          <a href="/invitations" class="flex items-center justify-between px-4 py-3 rounded-2xl bg-sky-50 text-sky-800 font-semibold hover:bg-sky-100">
            Nettoyer les IDCC
            <i class="fas fa-file-alt"></i>
          </a>
        </div>
      </article>
    </section>
  </div>
</main>
{% endblock %}
