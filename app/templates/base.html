<!doctype html>
<html lang="fr" class="scroll-smooth">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}PAP/CSE Tableau de bord{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- HTMX -->
  <script src="https://cdn.jsdelivr.net/npm/htmx.org@1.9.12"></script>

  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <!-- Alpine.js for interactivity -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            cgt: {
              red: '#d5001c',
              darkred: '#ab0015',
              lightred: '#ffe4ea',
              green: '#009846',
            }
          }
        }
      }
    }
  </script>

  <style>
    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .slide-in {
      animation: slideIn 0.3s ease-out;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    ::-webkit-scrollbar-thumb {
      background: #d5001c;
      border-radius: 5px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #ab0015;
    }

    /* Smooth transitions */
    * {
      transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
    }

    [x-cloak] {
      display: none !important;
    }

    /* Table hover effect */
    .table-row-hover:hover {
      transform: scale(1.01);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .sortable-header {
      cursor: pointer;
      user-select: none;
      position: relative;
      white-space: nowrap;
    }

    .sortable-header .sort-indicator {
      font-weight: normal;
      margin-left: 0.25rem;
      font-size: 0.75rem;
      opacity: 0.7;
      display: inline-block;
    }
  </style>

  {% block head %}{% endblock %}
</head>
<body class="bg-gray-50 min-h-screen" x-data="{ mobileMenuOpen: false }">

  <!-- Navigation Header -->
  <nav class="bg-gradient-to-r from-cgt-red to-cgt-darkred shadow-lg sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center h-20">

        <!-- Logo & Title -->
        <div class="flex items-center space-x-4">
          <img src="{{ url_for('static', path='logo-opcv2.svg') }}" alt="Logo Outils PAP Ciblage" class="h-16 w-auto bg-white/95 rounded-lg p-1 shadow-md object-contain border border-white/50">
          <div class="hidden md:block">
            <h1 class="text-2xl font-bold text-white tracking-tight">PAP/CSE · Tableau de bord</h1>
            <p class="text-sm text-red-100">Suivi ciblage PAP</p>
          </div>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden md:flex items-center space-x-2">
          <a href="/" class="px-4 py-2 rounded-lg text-white/95 hover:bg-white/20 transition flex items-center space-x-2">
            <i class="fas fa-home"></i>
            <span>Accueil</span>
          </a>

          <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false" @focusin="open = true" @focusout="open = false" @keydown.escape.window="open = false">
            <button type="button" class="px-4 py-2 rounded-lg text-white/95 hover:bg-white/20 transition flex items-center space-x-2" @click="open = !open">
              <i class="fas fa-database"></i>
              <span>Données PAP</span>
              <i class="fas fa-chevron-down text-xs transition-transform" :class="open ? 'rotate-180' : ''"></i>
            </button>
            <div x-cloak x-show="open" x-transition class="absolute right-0 mt-3 w-60 bg-white rounded-xl shadow-xl ring-1 ring-black/5 py-3">
              <a href="/invitations" class="block px-5 py-2 text-sm text-gray-700 hover:bg-gray-100/80 flex items-center space-x-2">
                <i class="fas fa-envelope-open-text text-cgt-red"></i>
                <span>Invitations PAP</span>
              </a>
              <a href="/extraction" class="block px-5 py-2 text-sm text-gray-700 hover:bg-gray-100/80 flex items-center space-x-2">
                <i class="fas fa-robot text-cgt-red"></i>
                <span>Extraction automatique</span>
              </a>
              <a href="/calendrier" class="block px-5 py-2 text-sm text-gray-700 hover:bg-gray-100/80 flex items-center space-x-2">
                <i class="fas fa-calendar-alt text-cgt-red"></i>
                <span>Calendrier +1000</span>
              </a>
            </div>
          </div>

          <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false" @focusin="open = true" @focusout="open = false" @keydown.escape.window="open = false">
            <button type="button" class="px-4 py-2 rounded-lg text-white/95 hover:bg-white/20 transition flex items-center space-x-2" @click="open = !open">
              <i class="fas fa-chart-line"></i>
              <span>Analyses &amp; ciblage</span>
              <i class="fas fa-chevron-down text-xs transition-transform" :class="open ? 'rotate-180' : ''"></i>
            </button>
            <div x-cloak x-show="open" x-transition class="absolute right-0 mt-3 w-64 bg-white rounded-xl shadow-xl ring-1 ring-black/5 py-3">
              <a href="/stats" class="block px-5 py-2 text-sm text-gray-700 hover:bg-gray-100/80 flex items-center space-x-2">
                <i class="fas fa-chart-simple text-cgt-red"></i>
                <span>Tableau de bord stats</span>
              </a>
              <a href="/recherche-siret" class="block px-5 py-2 text-sm text-gray-700 hover:bg-gray-100/80 flex items-center space-x-2">
                <i class="fas fa-search text-cgt-red"></i>
                <span>Recherche SIRET</span>
              </a>
              <a href="/ciblage" class="block px-5 py-2 text-sm text-gray-700 hover:bg-gray-100/80 flex items-center space-x-2">
                <i class="fas fa-crosshairs text-cgt-red"></i>
                <span>Outil de ciblage</span>
              </a>
              <a href="/cartographie" class="block px-5 py-2 text-sm text-gray-700 hover:bg-gray-100/80 flex items-center space-x-2">
                <i class="fas fa-map-marked-alt text-cgt-red"></i>
                <span>Cartographie France</span>
              </a>
            </div>
          </div>

          <div class="relative" x-data="{ open: false }" @mouseenter="open = true" @mouseleave="open = false" @focusin="open = true" @focusout="open = false" @keydown.escape.window="open = false">
            <button type="button" class="px-4 py-2 rounded-lg text-white/95 hover:bg-white/20 transition flex items-center space-x-2" @click="open = !open">
              <i class="fas fa-book-open"></i>
              <span>Ressources</span>
              <i class="fas fa-chevron-down text-xs transition-transform" :class="open ? 'rotate-180' : ''"></i>
            </button>
            <div x-cloak x-show="open" x-transition class="absolute right-0 mt-3 w-60 bg-white rounded-xl shadow-xl ring-1 ring-black/5 py-3">
              <a href="/presentation" class="block px-5 py-2 text-sm text-gray-700 hover:bg-gray-100/80 flex items-center space-x-2">
                <i class="fas fa-bullseye text-cgt-red"></i>
                <span>Présentation cible PAP</span>
              </a>
              <a href="/admin" class="block px-5 py-2 text-sm text-gray-700 hover:bg-gray-100/80 flex items-center space-x-2">
                <i class="fas fa-cog text-cgt-red"></i>
                <span>Espace administration</span>
              </a>
              <a href="https://cloud.cgt.fr/public.php/dav/files/jXycqmjkMpYbwXr/?accept=zip"
                 class="block px-5 py-2 text-sm text-gray-700 hover:bg-gray-100/80 flex items-center space-x-2"
                 target="_blank" rel="noopener">
                <i class="fas fa-cloud-arrow-down text-cgt-red"></i>
                <span>Kit ressources C5</span>
              </a>
            </div>
          </div>

          <a href="/calendrier" class="px-4 py-2 rounded-lg bg-white text-cgt-red font-semibold shadow hover:bg-gray-100 transition flex items-center space-x-2">
            <i class="fas fa-calendar-check"></i>
            <span>Calendrier +1000</span>
          </a>
        </div>

        <!-- Mobile menu button -->
        <button @click="mobileMenuOpen = !mobileMenuOpen" class="md:hidden text-white p-2">
          <i class="fas fa-bars text-2xl"></i>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div x-show="mobileMenuOpen"
         x-transition:enter="transition ease-out duration-200"
         x-transition:enter-start="opacity-0 transform -translate-y-4"
         x-transition:enter-end="opacity-100 transform translate-y-0"
         class="md:hidden bg-cgt-darkred border-t border-white/20">
      <div class="px-2 pt-2 pb-4 space-y-1" x-data="{ openSection: '' }">
        <a href="/" class="flex items-center justify-between px-3 py-3 rounded-md text-white hover:bg-white/20 transition" @click="mobileMenuOpen = false">
          <span><i class="fas fa-home mr-2"></i> Accueil</span>
          <i class="fas fa-chevron-right text-white/70"></i>
        </a>

        <button type="button"
                class="w-full flex items-center justify-between px-3 py-3 rounded-md text-white hover:bg-white/20 transition"
                @click="openSection = openSection === 'donnees' ? '' : 'donnees'">
          <span><i class="fas fa-database mr-2"></i> Données PAP</span>
          <i class="fas fa-chevron-down text-white/70 transition-transform" :class="openSection === 'donnees' ? 'rotate-180' : ''"></i>
        </button>
        <div x-cloak x-show="openSection === 'donnees'" x-transition class="ml-6 mb-2 space-y-1">
          <a href="/invitations" class="block px-3 py-2 rounded-md text-white/90 hover:bg-white/20 transition" @click="mobileMenuOpen = false">
            <i class="fas fa-envelope-open-text mr-2"></i> Invitations PAP
          </a>
          <a href="/calendrier" class="block px-3 py-2 rounded-md text-white/90 hover:bg-white/20 transition" @click="mobileMenuOpen = false">
            <i class="fas fa-calendar-alt mr-2"></i> Calendrier +1000
          </a>
        </div>

        <button type="button"
                class="w-full flex items-center justify-between px-3 py-3 rounded-md text-white hover:bg-white/20 transition"
                @click="openSection = openSection === 'analyses' ? '' : 'analyses'">
          <span><i class="fas fa-chart-line mr-2"></i> Analyses &amp; ciblage</span>
          <i class="fas fa-chevron-down text-white/70 transition-transform" :class="openSection === 'analyses' ? 'rotate-180' : ''"></i>
        </button>
        <div x-cloak x-show="openSection === 'analyses'" x-transition class="ml-6 mb-2 space-y-1">
          <a href="/stats" class="block px-3 py-2 rounded-md text-white/90 hover:bg-white/20 transition" @click="mobileMenuOpen = false">
            <i class="fas fa-chart-simple mr-2"></i> Tableau de bord stats
          </a>
          <a href="/recherche-siret" class="block px-3 py-2 rounded-md text-white/90 hover:bg-white/20 transition" @click="mobileMenuOpen = false">
            <i class="fas fa-search mr-2"></i> Recherche SIRET
          </a>
          <a href="/ciblage" class="block px-3 py-2 rounded-md text-white/90 hover:bg-white/20 transition" @click="mobileMenuOpen = false">
            <i class="fas fa-crosshairs mr-2"></i> Outil de ciblage
          </a>
          <a href="/cartographie" class="block px-3 py-2 rounded-md text-white/90 hover:bg-white/20 transition" @click="mobileMenuOpen = false">
            <i class="fas fa-map-marked-alt mr-2"></i> Cartographie France
          </a>
        </div>

        <button type="button"
                class="w-full flex items-center justify-between px-3 py-3 rounded-md text-white hover:bg-white/20 transition"
                @click="openSection = openSection === 'ressources' ? '' : 'ressources'">
          <span><i class="fas fa-book-open mr-2"></i> Ressources</span>
          <i class="fas fa-chevron-down text-white/70 transition-transform" :class="openSection === 'ressources' ? 'rotate-180' : ''"></i>
        </button>
        <div x-cloak x-show="openSection === 'ressources'" x-transition class="ml-6 mb-2 space-y-1">
          <a href="/presentation" class="block px-3 py-2 rounded-md text-white/90 hover:bg-white/20 transition" @click="mobileMenuOpen = false">
            <i class="fas fa-bullseye mr-2"></i> Présentation
          </a>
          <a href="/admin" class="block px-3 py-2 rounded-md text-white/90 hover:bg-white/20 transition" @click="mobileMenuOpen = false">
            <i class="fas fa-cog mr-2"></i> Administration
          </a>
          <a href="https://cloud.cgt.fr/public.php/dav/files/jXycqmjkMpYbwXr/?accept=zip"
             class="block px-3 py-2 rounded-md text-white/90 hover:bg-white/20 transition"
             target="_blank" rel="noopener" @click="mobileMenuOpen = false">
            <i class="fas fa-cloud-arrow-down mr-2"></i> Kit ressources C5
          </a>
        </div>

        <a href="/calendrier" class="block px-3 py-3 mt-2 rounded-md bg-white text-cgt-red font-semibold shadow hover:bg-gray-100 transition" @click="mobileMenuOpen = false">
          <i class="fas fa-calendar-check mr-2"></i> Calendrier +1000
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="bg-gray-800 text-white mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
          <h3 class="text-lg font-bold mb-3">PAP/CSE · Tableau de bord</h3>
          <p class="text-gray-400 text-sm">Suivi ciblage PAP</p>
        </div>
        <div>
          <h3 class="text-lg font-bold mb-3">Navigation</h3>
          <ul class="space-y-2 text-sm">
            <li><a href="/" class="text-gray-400 hover:text-white">Accueil</a></li>
            <li><a href="/presentation" class="text-gray-400 hover:text-white">Présentation</a></li>
            <li><a href="/recherche-siret" class="text-gray-400 hover:text-white">Recherche SIRET</a></li>
            <li><a href="/invitations" class="text-gray-400 hover:text-white">Invitations</a></li>
            <li><a href="/calendrier" class="text-gray-400 hover:text-white">Calendrier élections +1000</a></li>
            <li><a href="/ciblage" class="text-gray-400 hover:text-white">Ciblage</a></li>
            <li><a href="/cartographie" class="text-gray-400 hover:text-white">Cartographie France</a></li>
            <li><a href="/admin" class="text-gray-400 hover:text-white">Admin</a></li>
            <li><a href="https://cloud.cgt.fr/public.php/dav/files/jXycqmjkMpYbwXr/?accept=zip" target="_blank" rel="noopener" class="text-gray-400 hover:text-white">Kit ressources C5</a></li>
            <li><a href="/mentions-legales" class="text-gray-400 hover:text-white">Mentions légales</a></li>
          </ul>
        </div>
        <div>
          <h3 class="text-lg font-bold mb-3">API</h3>
          <ul class="space-y-2 text-sm text-gray-400">
            <li><i class="fas fa-check-circle text-green-500"></i> REST API disponible</li>
            <li><i class="fas fa-database text-blue-500"></i> Base SQLite</li>
            <li><i class="fas fa-shield-alt text-yellow-500"></i> Données sécurisées</li>
          </ul>
        </div>
      </div>
      <div class="border-t border-gray-700 mt-8 pt-6 text-center text-sm text-gray-400 space-y-2">
        <p>&copy; 2025 CGT - Tous droits réservés</p>
        <p>
          <a href="/mentions-legales" class="text-gray-400 hover:text-white underline-offset-2 hover:underline">Mentions légales</a>
        </p>
      </div>
    </div>
  </footer>

  <script src="/static/app.js"></script>

  <!-- Global utilities -->
  <script>
    // Toast notification system
    function showToast(message, type = 'info') {
      const toast = document.createElement('div');
      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        warning: 'bg-yellow-500',
        info: 'bg-blue-500'
      };

      toast.className = `fixed top-20 right-4 ${colors[type]} text-white px-6 py-4 rounded-lg shadow-lg z-50 slide-in`;
      toast.innerHTML = `<i class="fas fa-info-circle mr-2"></i>${message}`;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Loading spinner
    function showLoading() {
      const loader = document.createElement('div');
      loader.id = 'global-loader';
      loader.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
      loader.innerHTML = '<div class="bg-white rounded-lg p-8"><i class="fas fa-spinner fa-spin text-4xl text-cgt-red"></i></div>';
      document.body.appendChild(loader);
    }

    function hideLoading() {
      const loader = document.getElementById('global-loader');
      if (loader) loader.remove();
    }
  </script>
</body>
</html>
