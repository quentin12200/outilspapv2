# ü§ñ Guide d'Exploitation de l'IA GPT pour la Plateforme PAP/CSE

## üìã Table des mati√®res
1. [Utilisation actuelle](#utilisation-actuelle)
2. [Possibilit√©s d'exploitation imm√©diates](#possibilit√©s-dexploitation-imm√©diates)
3. [Am√©liorations avanc√©es](#am√©liorations-avanc√©es)
4. [Automatisation et intelligence](#automatisation-et-intelligence)
5. [Co√ªts et optimisation](#co√ªts-et-optimisation)

---

## ‚úÖ Utilisation actuelle

### Extraction de courriers PAP (document_extractor.py)
L'IA GPT-4 Vision est d√©j√† utilis√©e pour :

**üìÑ Ce qui est extrait automatiquement :**
- ‚úì SIRET (14 chiffres) et SIREN (9 chiffres)
- ‚úì Raison sociale et enseigne
- ‚úì Adresse compl√®te (rue, code postal, ville)
- ‚úì Dates (invitation, √©lection, limite candidature)
- ‚úì Effectif de l'entreprise
- ‚úì Type de scrutin (CSE, DP, CE, CHSCT)
- ‚úì Coll√®ges √©lectoraux
- ‚úì Nombre de si√®ges √† pourvoir
- ‚úì IDCC et convention collective
- ‚úì Syndicats invit√©s
- ‚úì Informations de contact (nom, fonction, email, t√©l√©phone)
- ‚úì Niveau de confiance (high/medium/low)

**üí∞ Co√ªts estim√©s :**
- `gpt-4o-mini` : ~0,015 centimes par document (tr√®s √©conomique)
- `gpt-4o` : ~0,5 centimes par document (recommand√©)
- Syst√®me de fallback automatique si un mod√®le n'est pas accessible

**üìä Fonctionnalit√©s disponibles :**
- Upload d'images (JPG, PNG, WEBP) jusqu'√† 10MB
- Upload de PDFs (conversion automatique en image)
- Extraction batch (plusieurs documents √† la fois)
- Sauvegarde automatique dans la base de donn√©es
- Tra√ßabilit√© avec source "IA - Extraction GPT"

---

## üöÄ Possibilit√©s d'exploitation imm√©diates

### 1. **Enrichissement automatique des donn√©es existantes**

#### A. Compl√©ter les invitations incompl√®tes
```python
# Possibilit√© : Scanner automatiquement les invitations sans IDCC
# et rechercher l'IDCC via IA sur le document original
```

**Utilisation :**
- R√©cup√©rer toutes les invitations avec `idcc IS NULL`
- Si le document original est disponible, le repasser dans l'IA
- Compl√©ter automatiquement l'IDCC manquant

#### B. Validation et correction des donn√©es
```python
# Possibilit√© : Utiliser l'IA pour d√©tecter les incoh√©rences
# Par exemple : SIRET qui ne correspond pas √† la raison sociale
```

**Exemple d'impl√©mentation :**
```python
# Nouveau endpoint : POST /api/extract/validate-invitation
{
  "siret": "12345678901234",
  "raison_sociale": "ABC Corp",
  "adresse": "123 Rue Example"
}
# R√©ponse IA : "‚ö†Ô∏è La raison sociale ne correspond pas au SIRET"
```

---

### 2. **Analyse intelligente de documents**

#### A. Classification automatique
L'IA peut classer automatiquement :
- Type de document (Invitation C5, PAP, Protocole d'accord, PV d'√©lection)
- Urgence (date limite proche)
- Compl√©tude (document complet ou partiel)

#### B. Extraction de protocoles d'accord pr√©√©lectoraux (PAP)
**Nouvelles donn√©es √† extraire :**
- Modalit√©s de vote (√©lectronique, urne, mixte)
- R√©partition des coll√®ges
- Conditions d'√©ligibilit√©
- Heures de d√©l√©gation
- Bureaux de vote

---

### 3. **D√©tection et alertes intelligentes**

#### A. Alertes automatiques sur les dates
```javascript
// L'IA peut d√©tecter et alerter sur :
- "‚ö†Ô∏è Date limite de candidature dans moins de 7 jours"
- "üî¥ √âlection pr√©vue dans moins de 14 jours"
- "‚è∞ Date d'invitation d√©pass√©e de 60 jours (retard)"
```

#### B. D√©tection d'anomalies
```javascript
// Exemples d'anomalies d√©tectables :
- SIRET invalide (nombre de chiffres incorrect)
- Date d'√©lection ant√©rieure √† la date d'invitation
- Effectif incompatible avec le nombre de si√®ges
- Code postal ne correspondant pas √† la ville
```

---

### 4. **Assistance √† la r√©daction**

#### A. G√©n√©ration de mod√®les de documents
L'IA peut g√©n√©rer :
- Mod√®les d'invitations PAP conformes
- Courriers de relance
- Protocoles d'accord type

**Exemple :**
```javascript
POST /api/ia/generer-invitation
{
  "siret": "12345678901234",
  "raison_sociale": "ABC Corp",
  "date_election": "2024-03-15"
}
// Retourne un courrier d'invitation complet et personnalis√©
```

#### B. Suggestions de corrections
```javascript
// L'IA peut sugg√©rer des am√©liorations :
"Votre protocole d'accord ne mentionne pas la modalit√© de vote.
Suggestion : Ajouter 'Vote √† bulletin secret sous enveloppe'"
```

---

### 5. **Recherche et requ√™tes en langage naturel**

#### Possibilit√© de cr√©er un chatbot intelligent

**Exemples de questions :**
```
Utilisateur : "Combien d'invitations PAP sont en retard dans le 75 ?"
IA : "Il y a 23 invitations en retard dans le d√©partement 75 (Paris)"

Utilisateur : "Quelles entreprises ont une √©lection pr√©vue ce mois-ci ?"
IA : "12 entreprises ont une √©lection pr√©vue en mars 2024 :
     - ABC Corp (SIRET: xxx) - 15/03/2024
     - DEF SA (SIRET: yyy) - 22/03/2024
     ..."

Utilisateur : "Analyse les invitations de la FD M√©tallurgie"
IA : "La FD M√©tallurgie a 145 invitations :
     - 80% sont √† jour
     - Effectif moyen : 87 salari√©s
     - D√©lai moyen entre invitation et √©lection : 45 jours"
```

---

### 6. **Analyse statistique et pr√©dictive**

#### A. Pr√©diction de succ√®s √©lectoral
```python
# L'IA peut analyser les donn√©es historiques pour pr√©dire :
- Probabilit√© de participation
- Taux de syndicalisation probable
- Nombre de candidatures attendues
```

#### B. Recommandations strat√©giques
```javascript
"Bas√© sur l'analyse de 500 √©lections similaires :
 ‚Üí Pr√©voir 2-3 candidats par coll√®ge
 ‚Üí Taux de participation estim√© : 65-75%
 ‚Üí Recommandation : Organiser une r√©union d'information 15 jours avant"
```

---

### 7. **Extraction de PV d'√©lections**

#### Nouvelles fonctionnalit√©s √† cr√©er

**POST /api/extract/pv-election**
Extraire depuis un PV :
- Nombre de votants
- Nombre de bulletins nuls
- R√©sultats par liste/syndicat
- √âlus par coll√®ge
- Incidents signal√©s

**Exemple de flux :**
1. Upload du PV d'√©lection (PDF/image)
2. Extraction automatique des r√©sultats
3. Mise √† jour de la base de donn√©es
4. G√©n√©ration d'un rapport d'analyse

---

### 8. **V√©rification de conformit√©**

#### Contr√¥le automatique des documents

**L'IA peut v√©rifier :**
```
‚úì Respect des d√©lais l√©gaux
‚úì Pr√©sence des mentions obligatoires
‚úì Conformit√© du protocole d'accord
‚úì Respect des effectifs par coll√®ge
‚úì Validit√© des SIRET/SIREN
```

**Exemple de rapport :**
```
üìÑ Document : Invitation_ABC_Corp.pdf
‚ùå Non conforme (2 erreurs)
  1. D√©lai d'invitation insuffisant (21 jours au lieu de 45)
  2. Mention "Modalit√© de vote" manquante
‚úì Conforme (3 points)
  1. SIRET valide
  2. Dates coh√©rentes
  3. Coll√®ges correctement d√©finis
```

---

### 9. **Enrichissement via API externes**

#### Combiner IA + API Sirene

**Workflow intelligent :**
```
1. IA extrait le SIRET du document
2. API Sirene r√©cup√®re les infos officielles
3. IA compare et d√©tecte les diff√©rences
4. Alerte si incoh√©rence d√©tect√©e
```

**Exemple :**
```javascript
Extraction IA : "Raison sociale : ABC Corporation"
API Sirene : "Raison sociale : ABC Corp SAS"
‚ö†Ô∏è Alerte : Diff√©rence d√©tect√©e dans la raison sociale
```

---

### 10. **Synth√®se et rapports automatiques**

#### A. Rapport hebdomadaire automatique

```javascript
// L'IA peut g√©n√©rer un rapport complet :
POST /api/ia/generer-rapport-hebdomadaire

R√©ponse :
"üìä Rapport PAP - Semaine du 10/03/2024

üìà STATISTIQUES
- 47 nouvelles invitations import√©es
- 12 √©lections r√©alis√©es
- 23 invitations en retard

‚ö†Ô∏è ALERTES
- 5 √©lections pr√©vues cette semaine
- 8 dates limites de candidature d√©pass√©es

üí° RECOMMANDATIONS
- Contacter les 23 entreprises en retard
- Prioriser les 5 √©lections de la semaine
- Relancer les syndicats pour les 8 candidatures en retard"
```

#### B. Analyse par UD/FD

```javascript
// Rapport personnalis√© par Union D√©partementale
"üìä Rapport UD 75 (Paris)

üéØ OBJECTIFS DU MOIS
- Objectif : 50 √©lections
- R√©alis√© : 32 (64%)
- Reste √† faire : 18

üìà TENDANCES
- +15% d'invitations vs mois dernier
- Taux de participation moyen : 72%
- 85% des PAP sont √† jour"
```

---

## üîß Am√©liorations avanc√©es

### 1. **OCR + IA pour documents manuscrits**

G√©rer les documents mal scann√©s ou annot√©s :
- ‚úì Extraction m√™me sur documents de mauvaise qualit√©
- ‚úì Lecture de notes manuscrites
- ‚úì Redressement d'images tordues

### 2. **Apprentissage continu**

Am√©liorer l'IA avec vos donn√©es :
```python
# Fine-tuning sur vos propres documents PAP
# ‚Üí L'IA devient plus pr√©cise sur VOS formats sp√©cifiques
```

### 3. **Multi-langues**

Si vous avez des documents en plusieurs langues :
- D√©tection automatique de la langue
- Extraction m√™me en anglais, espagnol, etc.

### 4. **Reconnaissance de signatures**

D√©tecter si un document a √©t√© sign√© :
- ‚úì Pr√©sence de signature(s)
- ‚úì Nombre de signataires
- ‚úì Localisation des signatures

---

## üí° Automatisation et intelligence

### Sc√©narios d'automatisation compl√®te

#### Sc√©nario 1 : Traitement automatique des emails
```
1. Email re√ßu avec pi√®ce jointe PAP
2. IA d√©tecte automatiquement qu'il s'agit d'une invitation
3. Extraction automatique des informations
4. Enregistrement dans la base de donn√©es
5. Notification envoy√©e au responsable UD/FD concern√©
6. Email de confirmation automatique √† l'exp√©diteur
```

#### Sc√©nario 2 : Workflow d'√©lection complet
```
1. Import de l'invitation ‚Üí Extraction IA
2. Cr√©ation automatique du dossier √©lection
3. Calcul automatique des si√®ges (service existant)
4. Alertes J-30, J-15, J-7 avant l'√©lection
5. Import du PV ‚Üí Extraction des r√©sultats
6. G√©n√©ration automatique du rapport d'√©lection
7. Mise √† jour des statistiques UD/FD
```

---

## üí∞ Co√ªts et optimisation

### Estimation des co√ªts

| Volume mensuel | Mod√®le | Co√ªt estim√© |
|----------------|--------|-------------|
| 100 documents | gpt-4o-mini | ~1,50 ‚Ç¨ |
| 100 documents | gpt-4o | ~50 ‚Ç¨ |
| 1000 documents | gpt-4o-mini | ~15 ‚Ç¨ |
| 1000 documents | gpt-4o | ~500 ‚Ç¨ |

### Recommandations d'optimisation

1. **Utiliser gpt-4o-mini pour :**
   - Extraction simple (invitations classiques)
   - Documents de bonne qualit√©
   - **√âconomie : 97% moins cher que gpt-4o**

2. **Utiliser gpt-4o pour :**
   - Documents complexes (protocoles d'accord)
   - Mauvaise qualit√© d'image
   - Extraction critique n√©cessitant haute pr√©cision

3. **Optimisations techniques :**
   - Redimensionner les images (max 2000px) ‚úì D√©j√† impl√©ment√©
   - Compression PNG optimis√©e ‚úì D√©j√† impl√©ment√©
   - Syst√®me de fallback automatique ‚úì D√©j√† impl√©ment√©
   - Cache des r√©sultats pour √©viter les doublons

---

## üéØ Priorisation des d√©veloppements

### Priorit√© 1 - Gains imm√©diats (1-2 jours)
1. ‚úÖ **Bouton d'ajout √† la BDD** ‚Üí **FAIT !**
2. üîú Enrichissement automatique des IDCC manquants
3. üîú Alertes sur les dates limites

### Priorit√© 2 - Valeur ajout√©e (1 semaine)
1. üîú Extraction de PV d'√©lections
2. üîú Validation de conformit√© des documents
3. üîú G√©n√©ration de rapports hebdomadaires

### Priorit√© 3 - Avanc√©es (2-4 semaines)
1. üîú Chatbot en langage naturel
2. üîú Analyse pr√©dictive
3. üîú Workflow d'automatisation complet

---

## üìù Exemples d'impl√©mentation

### Exemple 1 : Enrichir les IDCC manquants

```python
# Nouveau fichier : app/services/ia_enrichment.py

async def enrichir_idcc_manquants(db: Session):
    """
    Parcourt les invitations sans IDCC et tente de l'extraire
    depuis le document original via l'IA.
    """
    invitations_sans_idcc = db.query(Invitation).filter(
        Invitation.idcc.is_(None)
    ).all()

    for invitation in invitations_sans_idcc:
        # Si on a le document original stock√©
        if invitation.raw.get('_original_document'):
            extractor = DocumentExtractor()
            result = extractor.extract_from_document(...)

            if result.get('idcc'):
                invitation.idcc = result['idcc']
                db.commit()
                logger.info(f"IDCC enrichi pour {invitation.siret}")
```

### Exemple 2 : G√©n√©ration de rapport

```python
# Nouveau fichier : app/services/ia_reports.py

def generer_rapport_ia(db: Session, periode: str):
    """
    G√©n√®re un rapport intelligent avec l'IA.
    """
    # R√©cup√©rer les stats
    stats = calculer_statistiques(db, periode)

    # Utiliser l'IA pour g√©n√©rer un rapport narratif
    client = OpenAI(api_key=OPENAI_API_KEY)
    response = client.chat.completions.create(
        model="gpt-4o-mini",  # √âconomique pour la g√©n√©ration de texte
        messages=[{
            "role": "user",
            "content": f"""
            G√©n√®re un rapport hebdomadaire pour une plateforme de gestion PAP/CSE.

            Statistiques :
            {json.dumps(stats, indent=2)}

            Cr√©e un rapport professionnel avec :
            1. R√©sum√© ex√©cutif
            2. Statistiques cl√©s
            3. Alertes importantes
            4. Recommandations d'actions
            """
        }],
        temperature=0.3
    )

    return response.choices[0].message.content
```

---

## üîó Ressources et documentation

### Documentation OpenAI
- [Vision API Guide](https://platform.openai.com/docs/guides/vision)
- [Pricing](https://openai.com/pricing)
- [Best Practices](https://platform.openai.com/docs/guides/prompt-engineering)

### Code source de r√©f√©rence
- `app/services/document_extractor.py` - Service d'extraction IA
- `app/routers/api_document_extraction.py` - API d'extraction
- `app/templates/extraction.html` - Interface utilisateur

### Configuration requise
```bash
# .env
OPENAI_API_KEY=sk-...
OPENAI_MODEL=gpt-4o  # ou gpt-4o-mini pour √©conomiser
```

---

## üéì Formation et bonnes pratiques

### Conseils pour de meilleures extractions

1. **Qualit√© des images**
   - Privil√©gier les scans haute r√©solution (min 150 DPI)
   - √âviter les photos floues ou mal cadr√©es
   - Redresser les documents tordus avant upload

2. **V√©rification manuelle**
   - Toujours v√©rifier les SIRET extraits (14 chiffres)
   - Contr√¥ler les dates (format YYYY-MM-DD)
   - Valider les effectifs (coh√©rence avec les si√®ges)

3. **Feedback pour am√©lioration**
   - Noter les extractions incorrectes
   - Conserver les documents probl√©matiques
   - Signaler les cas d'√©chec pour am√©liorer le prompt

---

## üìû Support et questions

Pour toute question sur l'exploitation de l'IA :
1. Consultez ce guide
2. V√©rifiez les logs : `tail -f logs/app.log`
3. Testez avec des documents exemples
4. Documentez les cas d'usage r√©ussis

---

**Date de cr√©ation :** Mars 2024
**Version :** 1.0
**Derni√®re mise √† jour :** Impl√©mentation du bouton d'ajout √† la BDD
